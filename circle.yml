---
dependencies:
  pre:
    - sudo pip install docker-compose
    - gem install scss_lint
    - 'cd ~/bin; curl -o BrowserStackLocal-linux-x64.zip https://www.browserstack.com/browserstack-local/BrowserStackLocal-linux-x64.zip && unzip BrowserStackLocal-linux-x64.zip && chmod +x BrowserStackLocal && rm BrowserStackLocal-linux-x64.zip; cd -'
deployment:
  production:
    branch: master
    commands:
      - 'echo "machine api.heroku.com login jake.champion@ft.com password ${HEROKU_AUTH_TOKEN}" >> ${HOME}/.netrc;'
      - 'chmod 0600 /home/ubuntu/.netrc;'
      - 'docker login --email=jake.champion@ft.com --username=jakechampion --password=$(heroku auth:token) registry.heroku.com'
      - 'docker build -t registry.heroku.com/ftlabs-big-ft-test/web .'
      - 'docker push registry.heroku.com/ftlabs-big-ft-test/web'
machine:
  node:
    version: "5.1.0"
  services:
    - docker
test:
  # pre:
    # - docker build -t registry.heroku.com/ftlabs-big-ft-test/web .
  override:
    - docker-compose up -d web
    - npm test
  post:
   # docker-compose stop was not stopping containers started with docker-compose run
   # so using this hackity hack to force stop them all
   - docker stop $(docker ps -a -q)